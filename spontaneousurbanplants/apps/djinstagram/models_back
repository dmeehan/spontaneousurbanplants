# instagram/models.py

from django.conf import settings
from django.core.urlresolvers import reverse_lazy
from django.db import models

from instagram.bind import InstagramAPIError
from instagram.client import InstagramAPI


INSTAGRAM_CLIENT_ID = getattr(settings, 'INSTAGRAM_CLIENT_ID', None)
INSTAGRAM_CLIENT_SECRET = getattr(settings, 'INSTAGRAM_CLIENT_SECRET', None)

api = InstagramAPI(client_id=INSTAGRAM_CLIENT_ID, client_secret=INSTAGRAM_CLIENT_SECRET)


class InstagramTag(models.Model):
	"""
	An instagram Hashtag
	"""

	name = models.Charfield(max_length=100)
  sync = models.BooleanField(default=True,
                             help_text='Sync all media with this tag to local database.')
  subscribe = models.BooleanField(default=True,
                                  help_text='Subscribe to realtime updates for this tag.')
  moderate = models.BooleanField(default=True,
                                 help_text='If true, new media will default to hidden.')
	

	def subscribe(self):
		"""
		Create a realtime subscription to this tag
    """
    api.create_subscription(object='tag', 
                            object_id=self.name, 
                            aspect='media', 
                            callback_url=reverse_lazy('instagram-hook'))

  def unsubscribe(self):
    """
    Delete the realtime subscription
    """
    api.delete_subscriptions(id=self.subscription_id)
     

  def __unicode__(self):
      return u'%s' % (self.name)







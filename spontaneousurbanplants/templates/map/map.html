{% extends "base.html" %}
{% load staticfiles %}
{% load compress %}
{% block head_title %}Plant Map{% endblock %}

{% block extra_style %}
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7/leaflet.css" />
{% compress css %}
<script src="{% static 'bower_components/leaflet.markercluster/dist/Markercluster.css' %}"></script>
{% endcompress %}
{% endblock %}

{% block extra_js %}
<script src="http://cdn.leafletjs.com/leaflet-0.7/leaflet.js"></script>
{% compress js %}
<script src="{% static 'bower_components/leaflet.markercluster/dist/leaflet.markercluster.js' %}"></script>
{% endcompress %}
{% endblock %}

{% block content %}
<nav class="map-nav attributes">
	<ul>
	    {% for attribute in attribute_list %}
		<li style="background-image:url({{ attribute.icon.url }})"><a title="{{ attribute.hashtag }}" href="#">{{ attribute.name }}</a></li>
	    {% endfor %}
	</ul>
</nav>
<section class="map" id="map">
<p>Map</p>
</section>
<nav class="map-nav plants">
	<ul class="pre">
		{% for plant in plant_list|slice:":8" %}
		<li style="background-image:url({{ plant.icon.url }})"><a title="{{ plant.hashtag }}" href="#">{{ plant.common_name }}</a></li>
		{% endfor %}
	</ul>
        <ul class="post">
                {% for plant in plant_list|slice:"8:" %}
                <li style="background-image:url({{ plant.icon.url }})"><a title="{{ plant.hashtag }}" href="#">{{ plant.common_name }}</a></li>
                {% endfor %}
        </ul>


</nav>
{% endblock content %}
{% block extra_body %}
<script>

	 // create a map in the "map" div, set the view to a given place and zoom
	var map = L.map('map').setView([40.676898, -73.995308], 11);

	// add an OpenStreetMap tile layer
	L.tileLayer('http://api.tiles.mapbox.com/v3/mnegret.hi0oglpi/{z}/{x}/{y}.png', {
    	attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
	}).addTo(map);

	var geojsonMarkerOptions = {
    	radius: 30,
		fillColor: "#384037",
		color: "#000",
		weight: 0,
		opacity: 0,
		fillOpacity: 0.4
	};

	//var markers = new L.MarkerClusterGroup();

	function onEachFeature(feature, layer) {
    // does this feature have a property named popupContent?
	    //layer.bindPopup(feature);
	   	alert("test!")
	}

	var locations = $.getJSON("{% url 'api-image-list' %}?format=json", function(data) {
		L.geoJson(data, {
    		pointToLayer: function (feature, latlng) {
        		return L.circleMarker(latlng, geojsonMarkerOptions);
    		},
    		onEachFeature: onEachFeature
		}).addTo(map);
	})

	markers.addLayer(locations);
	
	//map.addLayer(locations);

    // Initialize the map object
    //var map = new L.Map('map', {
    //    doubleClickZoom: true,
    //    maxZoom: 20,
    //    minZoom: 11
    //});

    // Prep the background tile layer
    //var tileUrl = 'http://api.tiles.mapbox.com/v3/dmeehan.map-t3op9nm9/{z}/{x}/{y}.png';

    //var tileUrl = 'http://tile.stamen.com/toner/{z}/{x}/{y}.jpg'

    //var tileAttribution = 'Data &copy; <a href="http://openstreetmap.org/copyright">OpenStreetMap</a> contributors, Design &copy; MapBox';

    //var streets = L.tileLayer(tileUrl, {
    //    attribution: tileAttribution,
    //    minZoom: 11,
    //    maxZoom: 20
    //}).addTo(map);



</script>
{% endblock extra_body %}

{% extends "base.html" %}
{% load staticfiles %}
{% load compress %}
{% block head_title %}Plant Map{% endblock %}

{% block extra_style %}
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7/leaflet.css" />
{% compress css %}
<script src="{% static 'bower_components/leaflet.markercluster/dist/Markercluster.css' %}"></script>
{% endcompress %}
{% endblock %}

{% block extra_js %}
<script src="http://cdn.leafletjs.com/leaflet-0.7/leaflet.js"></script>
{% compress js %}
<script src="{% static 'bower_components/leaflet.markercluster/dist/leaflet.markercluster.js' %}"></script>
{% endcompress %}
{% endblock %}

{% block content %}
<nav class="map-nav attributes">
	<ul>
		{% for attribute in attribute_list %}
		<li>
			<p>{{ attribute.name }}</p>
		</li>
		{% endfor %}
	</ul>
</nav>
<section class="map" id="map">
<p>Map</p>
</section>
<nav class="map-nav plants">
	<ul>
		{% for plant in plant_list %}
		<li>
			<p>{{ plant.latin_name }}</p>
		</li>
		{% endfor %}
	</ul>
</nav>
{% endblock content %}
{% block extra_body %}
<script>

	 // create a map in the "map" div, set the view to a given place and zoom
	var map = L.map('map').setView([40.676898, -73.995308], 11);

	// add an OpenStreetMap tile layer
	L.tileLayer('http://api.tiles.mapbox.com/v3/dmeehan.map-t3op9nm9/{z}/{x}/{y}.png', {
    	attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
	}).addTo(map);

	var geojsonMarkerOptions = {
    	radius: 30,
		fillColor: "#384037",
		color: "#000",
		weight: 0,
		opacity: 0,
		fillOpacity: 0.4
	};

	var markers = new L.MarkerClusterGroup();

	var locations = $.getJSON("{% url 'api-image-list' %}?format=json", function(data) {
		L.geoJson(data, {
    		pointToLayer: function (feature, latlng) {
        		return L.circleMarker(latlng, geojsonMarkerOptions);
    		}
		}).addTo(map);
	})

	markers.addLayer(locations);
	
	//map.addLayer(locations);

    // Initialize the map object
    //var map = new L.Map('map', {
    //    doubleClickZoom: true,
    //    maxZoom: 20,
    //    minZoom: 11
    //});

    // Prep the background tile layer
    //var tileUrl = 'http://api.tiles.mapbox.com/v3/dmeehan.map-t3op9nm9/{z}/{x}/{y}.png';

    //var tileUrl = 'http://tile.stamen.com/toner/{z}/{x}/{y}.jpg'

    //var tileAttribution = 'Data &copy; <a href="http://openstreetmap.org/copyright">OpenStreetMap</a> contributors, Design &copy; MapBox';

    //var streets = L.tileLayer(tileUrl, {
    //    attribution: tileAttribution,
    //    minZoom: 11,
    //    maxZoom: 20
    //}).addTo(map);



</script>
{% endblock extra_body %}